{% extends "base.html" %}
{% block title %}The Grand Archives{% endblock %}

{% block content %}
<div style="display: flex; justify-content: space-between; align-items: center; border-bottom: 2px solid var(--ink); margin-bottom: 2rem;">
    <div>
        <h1 style="margin:0;">The Grand Archives</h1>
        <p style="font-style: italic; opacity: 0.8;">Knowledge of the Realm</p>
    </div>
    {% if user and user.role == 'GM' %}
    <a href="/wiki/new" class="btn">Write New Entry</a>
    {% endif %}
</div>

<!-- Newspaper Layout: 2 Columns that flow naturally -->
<div style="column-count: 2; column-gap: 2rem;">
    
    {% for group, subcats in library.items() %}
    <div style="background: var(--parchment); border: 1px solid #8b7d6b; padding: 1.5rem; margin-bottom: 2rem; box-shadow: 2px 2px 5px rgba(0,0,0,0.1); break-inside: avoid;">
        
        <!-- MAIN GROUP HEADER -->
        <h2 style="color: var(--accent); border-bottom: 2px solid var(--ink); margin-top: 0; font-variant: small-caps;">
            {{ group }}
        </h2>

        <!-- LOOP THROUGH SUBCATEGORIES -->
        {% for subname, pages in subcats.items() %}
        <div style="margin-bottom: 1.2rem;">
            
            <!-- SUBHEADER -->
            <h4 style="margin-bottom: 8px; color: #555; text-transform: uppercase; font-size: 0.75rem; letter-spacing: 1px; border-bottom: 1px dashed rgba(0,0,0,0.1);">
                {{ subname }}
            </h4>
            
            <!-- PAGES LIST -->
            <ul style="list-style: none; padding: 0; margin: 0;">
                {% for page in pages %}
                <li style="margin-bottom: 4px; padding-left: 8px; border-left: 3px solid rgba(0,0,0,0.1);">
                    <a href="/wiki/{{ page._id }}" style="color: var(--ink); text-decoration: none; display: block; transition: color 0.2s;">
                        ðŸ“œ {{ page.title }}
                    </a>
                </li>
                {% endfor %}
            </ul>
        </div>
        {% endfor %}

    </div>
    {% else %}
    <div style="column-span: all; text-align: center; padding: 3rem; opacity: 0.6;">
        <p>The archives are currently empty.</p>
    </div>
    {% endfor %}

</div>
{% endblock %}